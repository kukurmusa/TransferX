{% extends "base.html" %}
{% load humanize %}

{% block title %}Finance | TransferX{% endblock %}

{% block page_title %}<h1 class="text-2xl font-semibold text-white">Club finance</h1>{% endblock %}
{% block page_subtitle %}<p class="text-sm text-slate-400">Budgets and reserved funds</p>{% endblock %}

{% block content %}
  {% if finance %}
    {# Summary stat cards #}
    <div class="grid gap-4 sm:grid-cols-2">
      {% include "components/stat_card.html" with label="Transfer remaining" value=finance.transfer_remaining prefix="GBP" subtext="Available for offers" %}
      {% include "components/stat_card.html" with label="Wage remaining (weekly)" value=finance.wage_remaining_weekly prefix="GBP" subtext="Available for wage offers" %}
    </div>

    {# Budget progress bars #}
    <div class="mt-6 grid gap-4 sm:grid-cols-2">
      {# Transfer budget #}
      <div class="rounded-xl bg-slate-900 p-6 ring-1 ring-white/[0.08]">
        <h2 class="text-sm font-semibold text-white">Transfer budget</h2>
        {% if finance.transfer_budget_total and finance.transfer_budget_total > 0 %}
          <div class="mt-4">
            <div class="flex items-center justify-between text-xs text-slate-400">
              <span>Used</span>
              <span>GBP {{ finance.transfer_budget_total }}</span>
            </div>
            <div class="mt-1.5 h-3 w-full overflow-hidden rounded-full bg-slate-800">
              {% widthratio finance.transfer_remaining finance.transfer_budget_total 100 as transfer_pct_remaining %}
              {% widthratio finance.transfer_reserved finance.transfer_budget_total 100 as reserved_pct %}
              {% widthratio finance.transfer_committed finance.transfer_budget_total 100 as committed_pct %}
              <div class="flex h-full">
                {% if committed_pct %}
                  <div class="h-full bg-emerald-500" style="width: {{ committed_pct }}%"></div>
                {% endif %}
                {% if reserved_pct %}
                  <div class="h-full bg-amber-400" style="width: {{ reserved_pct }}%"></div>
                {% endif %}
              </div>
            </div>
            <div class="mt-2 flex items-center gap-4 text-xs text-slate-500">
              <span class="flex items-center gap-1"><span class="inline-block h-2 w-2 rounded-full bg-emerald-500"></span> Committed</span>
              <span class="flex items-center gap-1"><span class="inline-block h-2 w-2 rounded-full bg-amber-400"></span> Reserved</span>
              <span class="flex items-center gap-1"><span class="inline-block h-2 w-2 rounded-full bg-slate-800"></span> Available</span>
            </div>
          </div>
        {% endif %}
        <div class="mt-4 space-y-1">
          {% include "components/metric.html" with label="Total" value=finance.transfer_budget_total %}
          {% include "components/metric.html" with label="Reserved" value=finance.transfer_reserved %}
          {% include "components/metric.html" with label="Committed" value=finance.transfer_committed %}
        </div>
      </div>

      {# Wage budget #}
      <div class="rounded-xl bg-slate-900 p-6 ring-1 ring-white/[0.08]">
        <h2 class="text-sm font-semibold text-white">Wage budget (weekly)</h2>
        {% if finance.wage_budget_total_weekly and finance.wage_budget_total_weekly > 0 %}
          <div class="mt-4">
            <div class="flex items-center justify-between text-xs text-slate-400">
              <span>Used</span>
              <span>GBP {{ finance.wage_budget_total_weekly }}</span>
            </div>
            <div class="mt-1.5 h-3 w-full overflow-hidden rounded-full bg-slate-800">
              {% widthratio finance.wage_committed_weekly finance.wage_budget_total_weekly 100 as wage_committed_pct %}
              {% widthratio finance.wage_reserved_weekly finance.wage_budget_total_weekly 100 as wage_reserved_pct %}
              <div class="flex h-full">
                {% if wage_committed_pct %}
                  <div class="h-full bg-emerald-500" style="width: {{ wage_committed_pct }}%"></div>
                {% endif %}
                {% if wage_reserved_pct %}
                  <div class="h-full bg-amber-400" style="width: {{ wage_reserved_pct }}%"></div>
                {% endif %}
              </div>
            </div>
            <div class="mt-2 flex items-center gap-4 text-xs text-slate-500">
              <span class="flex items-center gap-1"><span class="inline-block h-2 w-2 rounded-full bg-emerald-500"></span> Committed</span>
              <span class="flex items-center gap-1"><span class="inline-block h-2 w-2 rounded-full bg-amber-400"></span> Reserved</span>
              <span class="flex items-center gap-1"><span class="inline-block h-2 w-2 rounded-full bg-slate-800"></span> Available</span>
            </div>
          </div>
        {% endif %}
        <div class="mt-4 space-y-1">
          {% include "components/metric.html" with label="Total" value=finance.wage_budget_total_weekly %}
          {% include "components/metric.html" with label="Reserved" value=finance.wage_reserved_weekly %}
          {% include "components/metric.html" with label="Committed" value=finance.wage_committed_weekly %}
        </div>
      </div>
    </div>

    <div class="mt-6 rounded-xl bg-slate-800/40 px-4 py-3 text-sm text-slate-400">
      Reservations are held while your offers are active. When an offer is rejected or a listing closes, reserved funds are released automatically.
    </div>
  {% else %}
    {% include "components/empty_state.html" with title="No finance profile" description="We could not find a finance profile for your club." %}
  {% endif %}
{% endblock %}
