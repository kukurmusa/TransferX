{% extends "base.html" %}

{% block title %}Listing | TransferX{% endblock %}

{% block page_title %}<h1 class="text-2xl font-semibold text-white">{{ listing.player.name }}</h1>{% endblock %}
{% block page_subtitle %}<p class="text-sm text-slate-400">Listing details and market context.</p>{% endblock %}

{% block content %}
  <div class="grid gap-6 lg:grid-cols-[2fr_3fr]">
    <div class="rounded-2xl border border-white/10 bg-slate-900/70 p-6">
      <div class="flex items-center gap-4">
        <div class="flex h-20 w-20 items-center justify-center rounded-2xl bg-slate-800 text-3xl text-slate-400">
          <span>ðŸ‘¤</span>
        </div>
        <div>
          <div class="text-xl font-semibold text-white">{{ listing.player.name }}</div>
          <div class="text-sm text-slate-400">
            {{ listing.player.get_position_display|default:"-" }} â€¢ Age {{ listing.player.age|default:"-" }}
          </div>
          <div class="text-xs text-slate-500">
            {% if listing.player.current_club %}{{ listing.player.current_club.name }}{% else %}Free agent{% endif %}
          </div>
        </div>
      </div>

      <div class="mt-6 grid gap-4 text-sm text-slate-400 sm:grid-cols-2">
        <div>
          <div class="text-xs font-semibold uppercase tracking-[0.2em] text-slate-500">Nationality</div>
          <div class="mt-1 text-sm font-semibold text-slate-100">{{ listing.player.nationality|default:"-" }}</div>
        </div>
        <div>
          <div class="text-xs font-semibold uppercase tracking-[0.2em] text-slate-500">Position</div>
          <div class="mt-1 text-sm font-semibold text-slate-100">{{ listing.player.get_position_display|default:"-" }}</div>
        </div>
      </div>

      <div class="mt-6">
        <div class="flex items-center justify-between text-xs text-slate-500">
          <span>Form score</span>
          <span class="text-slate-300">{% if listing.player.form %}{{ listing.player.form.form_score|floatformat:0 }}{% else %}-{% endif %}</span>
        </div>
        <div class="mt-2 h-2 w-full overflow-hidden rounded-full bg-slate-800">
          <div
            class="h-full bg-gradient-to-r from-emerald-400 via-amber-400 to-red-400"
            style="width: {% if listing.player.form %}{{ listing.player.form.form_score|floatformat:0 }}{% else %}0{% endif %}%;"
          ></div>
        </div>
      </div>

      {% if recent_form %}
        <div class="mt-6">
          <div class="text-xs font-semibold uppercase tracking-[0.2em] text-slate-500">Recent form</div>
          <div class="mt-2 flex flex-wrap gap-2">
            {% for result in recent_form %}
              <span class="rounded-full border border-white/10 px-3 py-1 text-xs font-semibold
                {% if result == 'W' %}bg-emerald-500/15 text-emerald-200 border-emerald-400/40
                {% elif result == 'D' %}bg-amber-500/15 text-amber-200 border-amber-400/40
                {% elif result == 'L' %}bg-red-500/15 text-red-200 border-red-400/40
                {% else %}bg-slate-800 text-slate-300{% endif %}
              ">{{ result }}</span>
            {% endfor %}
          </div>
        </div>
      {% endif %}

      <div class="mt-8">
        <div class="text-xs font-semibold uppercase tracking-[0.2em] text-slate-500">Season stats</div>
        <div class="mt-3 overflow-hidden rounded-xl border border-white/10">
          <table class="w-full text-left text-sm text-slate-300">
            <thead class="bg-slate-900/80 text-xs uppercase tracking-wider text-slate-500">
              <tr>
                <th class="px-4 py-3">Rating</th>
                <th class="px-4 py-3">Goals</th>
                <th class="px-4 py-3">Assists</th>
                <th class="px-4 py-3">Minutes</th>
                <th class="px-4 py-3">Apps</th>
              </tr>
            </thead>
            <tbody class="divide-y divide-white/5">
              <tr>
                <td class="px-4 py-3">{% if player_stats and player_stats.avg_rating %}{{ player_stats.avg_rating|floatformat:1 }}{% else %}-{% endif %}</td>
                <td class="px-4 py-3">{% if player_stats and player_stats.goals is not None %}{{ player_stats.goals }}{% else %}-{% endif %}</td>
                <td class="px-4 py-3">{% if player_stats and player_stats.assists is not None %}{{ player_stats.assists }}{% else %}-{% endif %}</td>
                <td class="px-4 py-3">{% if player_stats and player_stats.minutes is not None %}{{ player_stats.minutes }}{% else %}-{% endif %}</td>
                <td class="px-4 py-3">-</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <div class="space-y-6">
      <div class="rounded-2xl border border-white/10 bg-slate-900/70 p-6">
        <div class="flex items-start justify-between gap-4">
          <div>
            <div class="text-xs font-semibold uppercase tracking-[0.2em] text-slate-500">Listing</div>
            <div class="mt-1 text-lg font-semibold text-white">{{ listing.get_listing_type_display }}</div>
          </div>
          <span class="rounded-full border border-white/10 bg-slate-800 px-3 py-1 text-xs font-semibold text-slate-200">
            {{ offers_count }} offers received
          </span>
        </div>

        <div class="mt-6 grid gap-4 sm:grid-cols-2">
          <div class="rounded-xl border border-white/10 bg-slate-950/60 p-4">
            <div class="text-xs font-semibold uppercase tracking-[0.2em] text-slate-500">Asking</div>
            <div class="mt-2 text-lg font-semibold text-emerald-200">
              {% if listing.asking_price %}GBP {{ listing.asking_price }}{% else %}Negotiable{% endif %}
            </div>
          </div>
          <div class="rounded-xl border border-white/10 bg-slate-950/60 p-4">
            <div class="text-xs font-semibold uppercase tracking-[0.2em] text-slate-500">Contract</div>
            <div class="mt-2 text-sm font-semibold text-slate-100">
              {% if contract_end_date %}
                {{ contract_end_date|timeuntil }} remaining
              {% elif listing.player.status == "FREE_AGENT" %}
                Free agent
              {% else %}
                -
              {% endif %}
            </div>
          </div>
          <div class="rounded-xl border border-white/10 bg-slate-950/60 p-4">
            <div class="text-xs font-semibold uppercase tracking-[0.2em] text-slate-500">Listed</div>
            <div class="mt-2 text-sm font-semibold text-slate-100">{{ listing.created_at|date:"M d, Y" }}</div>
          </div>
          <div class="rounded-xl border border-white/10 bg-slate-950/60 p-4">
            <div class="text-xs font-semibold uppercase tracking-[0.2em] text-slate-500">Deadline</div>
            <div class="mt-2 text-sm font-semibold text-slate-100">{% if listing.deadline %}{{ listing.deadline|date:"M d, H:i" }}{% else %}-{% endif %}</div>
          </div>
        </div>
      </div>

      <div class="rounded-2xl border border-white/10 bg-slate-900/70 p-6">
        <div class="text-xs font-semibold uppercase tracking-[0.2em] text-slate-500">Seller club</div>
        <div class="mt-3 rounded-xl border border-white/10 bg-slate-950/60 p-4">
          <div class="text-lg font-semibold text-white">
            {% if listing.listed_by_club %}{{ listing.listed_by_club.name }}{% else %}Free agent{% endif %}
          </div>
          <div class="mt-1 text-sm text-slate-400">
            {% if listing.listed_by_club %}
              {{ listing.listed_by_club.league_name|default:"" }} {% if listing.listed_by_club.country %}â€¢ {{ listing.listed_by_club.country }}{% endif %}
            {% else %}
              Available to all clubs
            {% endif %}
          </div>
        </div>

        <div class="mt-5 space-y-3">
          {% if is_seller %}
            <div class="text-sm text-slate-400">You are the selling club.</div>
            {% include "components/button.html" with text="Manage Listing" href="/admin/marketplace/listing/"|add:listing.id|add:"/change/" variant="secondary" size="md" extra_classes="w-full" %}
          {% else %}
            {% if listing.listing_type == "FREE_AGENT" or listing.player.status == "FREE_AGENT" %}
              {% include "components/button.html" with text="Make Offer to Player" href="/marketplace/offers/new/?player="|add:listing.player.id variant="primary" size="md" extra_classes="w-full" %}
            {% else %}
              {% include "components/button.html" with text="Make Offer" href="/marketplace/offers/new/?player="|add:listing.player.id|add:"&listing="|add:listing.id variant="primary" size="md" extra_classes="w-full" %}
            {% endif %}
          {% endif %}
        </div>
      </div>
    </div>
  </div>

  <div class="mt-10">
    <div class="flex items-center justify-between">
      <h2 class="text-lg font-semibold text-white">Related listings</h2>
      <a class="text-xs font-semibold uppercase tracking-[0.2em] text-emerald-300 hover:text-emerald-200 no-underline" href="/listings/">View all</a>
    </div>
    <div class="mt-4 grid gap-6 sm:grid-cols-2 xl:grid-cols-4">
      {% for related in related_listings %}
        <div class="rounded-2xl border border-white/10 bg-slate-900/70 p-4">
          <div class="flex items-center justify-between">
            <span class="rounded-full border border-white/10 bg-slate-800 px-3 py-1 text-xs font-semibold text-slate-200">
              {{ related.get_listing_type_display }}
            </span>
            <span class="text-xs text-slate-500">Form {% if related.player.form %}{{ related.player.form.form_score|floatformat:0 }}{% else %}-{% endif %}</span>
          </div>
          <div class="mt-3 text-base font-semibold text-white">{{ related.player.name }}</div>
          <div class="text-sm text-slate-400">
            {% if related.listed_by_club %}{{ related.listed_by_club.name }}{% else %}Free agent{% endif %}
          </div>
          <div class="mt-4 flex items-center justify-between text-xs text-slate-400">
            <span>{% if related.asking_price %}GBP {{ related.asking_price }}{% else %}Negotiable{% endif %}</span>
            <a class="text-emerald-300 hover:text-emerald-200 no-underline" href="/listings/{{ related.id }}/">View</a>
          </div>
        </div>
      {% empty %}
        <div class="rounded-2xl border border-white/10 bg-slate-900/70 p-6 text-sm text-slate-400">
          No related listings right now.
        </div>
      {% endfor %}
    </div>
  </div>
{% endblock %}
