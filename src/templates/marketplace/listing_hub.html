{% extends "base.html" %}

{% block title %}Listings | TransferX{% endblock %}

{% block page_title %}<h1 class="text-2xl font-semibold text-white">Listings</h1>{% endblock %}
{% block page_subtitle %}<p class="text-sm text-slate-400">Live transfer, loan, and free agent listings.</p>{% endblock %}

{% block content %}
  <form id="listing-filters" method="get" class="mb-8 space-y-5">
    <div class="flex flex-wrap items-center justify-between gap-4 rounded-2xl border border-white/10 bg-slate-950/60 p-4">
      <div class="flex flex-wrap items-center gap-2">
        <span class="text-xs font-semibold uppercase tracking-[0.2em] text-slate-500">Type</span>
        <label class="flex items-center">
          <input
            type="radio"
            name="type"
            value=""
            class="peer sr-only"
            {% if not filters.type %}checked{% endif %}
            hx-get="/listings/"
            hx-target="#listing-grid"
            hx-include="#listing-filters"
            hx-trigger="change"
            hx-push-url="true"
          />
          <span class="rounded-full border border-white/10 px-3 py-1 text-xs font-semibold text-slate-300 transition peer-checked:border-emerald-400/60 peer-checked:bg-emerald-500/15 peer-checked:text-emerald-200">All</span>
        </label>
        <label class="flex items-center">
          <input
            type="radio"
            name="type"
            value="TRANSFER"
            class="peer sr-only"
            {% if filters.type == "TRANSFER" %}checked{% endif %}
            hx-get="/listings/"
            hx-target="#listing-grid"
            hx-include="#listing-filters"
            hx-trigger="change"
            hx-push-url="true"
          />
          <span class="rounded-full border border-white/10 px-3 py-1 text-xs font-semibold text-slate-300 transition peer-checked:border-emerald-400/60 peer-checked:bg-emerald-500/15 peer-checked:text-emerald-200">Transfer</span>
        </label>
        <label class="flex items-center">
          <input
            type="radio"
            name="type"
            value="LOAN"
            class="peer sr-only"
            {% if filters.type == "LOAN" %}checked{% endif %}
            hx-get="/listings/"
            hx-target="#listing-grid"
            hx-include="#listing-filters"
            hx-trigger="change"
            hx-push-url="true"
          />
          <span class="rounded-full border border-white/10 px-3 py-1 text-xs font-semibold text-slate-300 transition peer-checked:border-emerald-400/60 peer-checked:bg-emerald-500/15 peer-checked:text-emerald-200">Loan</span>
        </label>
        <label class="flex items-center">
          <input
            type="radio"
            name="type"
            value="FREE_AGENT"
            class="peer sr-only"
            {% if filters.type == "FREE_AGENT" %}checked{% endif %}
            hx-get="/listings/"
            hx-target="#listing-grid"
            hx-include="#listing-filters"
            hx-trigger="change"
            hx-push-url="true"
          />
          <span class="rounded-full border border-white/10 px-3 py-1 text-xs font-semibold text-slate-300 transition peer-checked:border-emerald-400/60 peer-checked:bg-emerald-500/15 peer-checked:text-emerald-200">Free Agent</span>
        </label>
      </div>

      <div class="flex flex-wrap items-center gap-3">
        <div class="flex items-center gap-2 text-xs text-slate-400">
          <span class="uppercase tracking-wide text-slate-500">Price</span>
          <input
            type="number"
            name="min_price"
            value="{{ filters.min_price }}"
            placeholder="Min"
            class="w-24 rounded-full border border-white/10 bg-slate-900/60 px-3 py-1 text-xs text-slate-200 placeholder:text-slate-500"
            hx-get="/listings/"
            hx-target="#listing-grid"
            hx-include="#listing-filters"
            hx-trigger="change"
            hx-push-url="true"
          />
          <span class="text-slate-600">-</span>
          <input
            type="number"
            name="max_price"
            value="{{ filters.max_price }}"
            placeholder="Max"
            class="w-24 rounded-full border border-white/10 bg-slate-900/60 px-3 py-1 text-xs text-slate-200 placeholder:text-slate-500"
            hx-get="/listings/"
            hx-target="#listing-grid"
            hx-include="#listing-filters"
            hx-trigger="change"
            hx-push-url="true"
          />
        </div>
      </div>
    </div>

    <div class="flex flex-wrap items-center gap-3">
      <div class="flex flex-wrap items-center gap-2 rounded-2xl border border-white/10 bg-slate-950/60 p-4">
        <div class="text-xs font-semibold uppercase tracking-[0.2em] text-slate-500">Position</div>
        <label class="flex items-center">
          <input
            type="radio"
            name="position"
            value=""
            class="peer sr-only"
            {% if not filters.position %}checked{% endif %}
            hx-get="/listings/"
            hx-target="#listing-grid"
            hx-include="#listing-filters"
            hx-trigger="change"
            hx-push-url="true"
          />
          <span class="rounded-full border border-white/10 px-3 py-1 text-xs font-semibold text-slate-300 transition peer-checked:border-emerald-400/60 peer-checked:bg-emerald-500/15 peer-checked:text-emerald-200">All</span>
        </label>
        <label class="flex items-center">
          <input
            type="radio"
            name="position"
            value="GK"
            class="peer sr-only"
            {% if filters.position == "GK" %}checked{% endif %}
            hx-get="/listings/"
            hx-target="#listing-grid"
            hx-include="#listing-filters"
            hx-trigger="change"
            hx-push-url="true"
          />
          <span class="rounded-full border border-white/10 px-3 py-1 text-xs font-semibold text-slate-300 transition peer-checked:border-emerald-400/60 peer-checked:bg-emerald-500/15 peer-checked:text-emerald-200">GK</span>
        </label>
        <label class="flex items-center">
          <input
            type="radio"
            name="position"
            value="DEF"
            class="peer sr-only"
            {% if filters.position == "DEF" %}checked{% endif %}
            hx-get="/listings/"
            hx-target="#listing-grid"
            hx-include="#listing-filters"
            hx-trigger="change"
            hx-push-url="true"
          />
          <span class="rounded-full border border-white/10 px-3 py-1 text-xs font-semibold text-slate-300 transition peer-checked:border-emerald-400/60 peer-checked:bg-emerald-500/15 peer-checked:text-emerald-200">DEF</span>
        </label>
        <label class="flex items-center">
          <input
            type="radio"
            name="position"
            value="MID"
            class="peer sr-only"
            {% if filters.position == "MID" %}checked{% endif %}
            hx-get="/listings/"
            hx-target="#listing-grid"
            hx-include="#listing-filters"
            hx-trigger="change"
            hx-push-url="true"
          />
          <span class="rounded-full border border-white/10 px-3 py-1 text-xs font-semibold text-slate-300 transition peer-checked:border-emerald-400/60 peer-checked:bg-emerald-500/15 peer-checked:text-emerald-200">MID</span>
        </label>
        <label class="flex items-center">
          <input
            type="radio"
            name="position"
            value="FWD"
            class="peer sr-only"
            {% if filters.position == "FWD" %}checked{% endif %}
            hx-get="/listings/"
            hx-target="#listing-grid"
            hx-include="#listing-filters"
            hx-trigger="change"
            hx-push-url="true"
          />
          <span class="rounded-full border border-white/10 px-3 py-1 text-xs font-semibold text-slate-300 transition peer-checked:border-emerald-400/60 peer-checked:bg-emerald-500/15 peer-checked:text-emerald-200">FWD</span>
        </label>
      </div>

      <div class="flex flex-1 flex-wrap items-center gap-3">
        <div class="flex items-center gap-2 rounded-2xl border border-white/10 bg-slate-950/60 px-3 py-2">
          <span class="text-xs font-semibold uppercase tracking-[0.2em] text-slate-500">Sort</span>
          <select
            name="sort"
            class="bg-transparent text-sm text-slate-200"
            hx-get="/listings/"
            hx-target="#listing-grid"
            hx-include="#listing-filters"
            hx-trigger="change"
            hx-push-url="true"
          >
            <option value="newest" {% if filters.sort == "newest" or not filters.sort %}selected{% endif %}>Newest</option>
            <option value="price_asc" {% if filters.sort == "price_asc" %}selected{% endif %}>Price (Low-High)</option>
            <option value="price_desc" {% if filters.sort == "price_desc" %}selected{% endif %}>Price (High-Low)</option>
            <option value="form_desc" {% if filters.sort == "form_desc" %}selected{% endif %}>Form score</option>
          </select>
        </div>
        <div class="flex items-center gap-2 rounded-2xl border border-white/10 bg-slate-950/60 px-3 py-2">
          <span class="text-xs font-semibold uppercase tracking-[0.2em] text-slate-500">Club</span>
          <select
            name="club"
            class="bg-transparent text-sm text-slate-200"
            hx-get="/listings/"
            hx-target="#listing-grid"
            hx-include="#listing-filters"
            hx-trigger="change"
            hx-push-url="true"
          >
            <option value="" {% if not filters.club %}selected{% endif %}>All clubs</option>
            {% for club in seller_clubs %}
              <option value="{{ club.id }}" {% if filters.club == club.id|stringformat:"s" %}selected{% endif %}>{{ club.name }}</option>
            {% endfor %}
          </select>
        </div>
      </div>
    </div>
  </form>

  <div class="relative">
    <div id="listing-grid" class="space-y-6" hx-indicator="#listing-grid-loading">
      {% include "marketplace/_listing_cards.html" %}
    </div>
    <div id="listing-grid-loading" class="htmx-indicator absolute inset-0 flex items-center justify-center bg-slate-950/70 text-slate-200">
      <div class="flex items-center gap-3 rounded-full border border-white/10 bg-slate-900/80 px-4 py-2 text-xs font-semibold uppercase tracking-[0.2em] text-slate-300">
        <span class="h-3 w-3 animate-spin rounded-full border-2 border-slate-500 border-t-emerald-400"></span>
        Loading
      </div>
    </div>
  </div>
{% endblock %}
