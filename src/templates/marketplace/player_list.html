{% extends "base.html" %}

{% block title %}Players Market | TransferX{% endblock %}

{% block page_title %}<h1 class="text-2xl font-semibold text-white">Players market</h1>{% endblock %}
{% block page_subtitle %}<p class="text-sm text-slate-400">Scout form, compare availability, and shortlist targets.</p>{% endblock %}

{% block content %}
  <form id="player-filters" method="get" class="mb-8 space-y-5">
    <div class="flex flex-wrap items-center justify-between gap-4 rounded-2xl border border-white/10 bg-slate-950/60 p-4">
      <div class="flex flex-wrap items-center gap-2">
        <span class="text-xs font-semibold uppercase tracking-[0.2em] text-slate-500">Position</span>
        <label class="flex items-center">
          <input
            type="radio"
            name="position"
            value=""
            class="peer sr-only"
            {% if not filters.position %}checked{% endif %}
            hx-get="/players/market/"
            hx-target="#player-grid"
            hx-include="#player-filters"
            hx-trigger="change"
            hx-push-url="true"
          />
          <span class="rounded-full border border-white/10 px-3 py-1 text-xs font-semibold text-slate-300 transition peer-checked:border-emerald-400/60 peer-checked:bg-emerald-500/15 peer-checked:text-emerald-200">All</span>
        </label>
        <label class="flex items-center">
          <input
            type="radio"
            name="position"
            value="GK"
            class="peer sr-only"
            {% if filters.position == "GK" %}checked{% endif %}
            hx-get="/players/market/"
            hx-target="#player-grid"
            hx-include="#player-filters"
            hx-trigger="change"
            hx-push-url="true"
          />
          <span class="rounded-full border border-white/10 px-3 py-1 text-xs font-semibold text-slate-300 transition peer-checked:border-emerald-400/60 peer-checked:bg-emerald-500/15 peer-checked:text-emerald-200">GK</span>
        </label>
        <label class="flex items-center">
          <input
            type="radio"
            name="position"
            value="DEF"
            class="peer sr-only"
            {% if filters.position == "DEF" %}checked{% endif %}
            hx-get="/players/market/"
            hx-target="#player-grid"
            hx-include="#player-filters"
            hx-trigger="change"
            hx-push-url="true"
          />
          <span class="rounded-full border border-white/10 px-3 py-1 text-xs font-semibold text-slate-300 transition peer-checked:border-emerald-400/60 peer-checked:bg-emerald-500/15 peer-checked:text-emerald-200">DEF</span>
        </label>
        <label class="flex items-center">
          <input
            type="radio"
            name="position"
            value="MID"
            class="peer sr-only"
            {% if filters.position == "MID" %}checked{% endif %}
            hx-get="/players/market/"
            hx-target="#player-grid"
            hx-include="#player-filters"
            hx-trigger="change"
            hx-push-url="true"
          />
          <span class="rounded-full border border-white/10 px-3 py-1 text-xs font-semibold text-slate-300 transition peer-checked:border-emerald-400/60 peer-checked:bg-emerald-500/15 peer-checked:text-emerald-200">MID</span>
        </label>
        <label class="flex items-center">
          <input
            type="radio"
            name="position"
            value="FWD"
            class="peer sr-only"
            {% if filters.position == "FWD" %}checked{% endif %}
            hx-get="/players/market/"
            hx-target="#player-grid"
            hx-include="#player-filters"
            hx-trigger="change"
            hx-push-url="true"
          />
          <span class="rounded-full border border-white/10 px-3 py-1 text-xs font-semibold text-slate-300 transition peer-checked:border-emerald-400/60 peer-checked:bg-emerald-500/15 peer-checked:text-emerald-200">FWD</span>
        </label>
      </div>
      <div class="flex flex-wrap items-center gap-3">
        <div class="flex items-center gap-2 text-xs text-slate-400">
          <span class="uppercase tracking-wide text-slate-500">Age</span>
          <div class="flex items-center gap-2 rounded-full border border-white/10 bg-slate-900/60 px-3 py-1">
            <input
              type="range"
              name="min_age"
              min="16"
              max="40"
              value="{{ filters.min_age|default:'16' }}"
              class="h-1 w-24 accent-emerald-400"
              oninput="this.nextElementSibling.value = this.value"
              hx-get="/players/market/"
              hx-target="#player-grid"
              hx-include="#player-filters"
              hx-trigger="change"
              hx-push-url="true"
            />
            <output class="text-xs text-slate-300">{{ filters.min_age|default:"16" }}</output>
          </div>
          <div class="flex items-center gap-2 rounded-full border border-white/10 bg-slate-900/60 px-3 py-1">
            <input
              type="range"
              name="max_age"
              min="16"
              max="40"
              value="{{ filters.max_age|default:'40' }}"
              class="h-1 w-24 accent-emerald-400"
              oninput="this.nextElementSibling.value = this.value"
              hx-get="/players/market/"
              hx-target="#player-grid"
              hx-include="#player-filters"
              hx-trigger="change"
              hx-push-url="true"
            />
            <output class="text-xs text-slate-300">{{ filters.max_age|default:"40" }}</output>
          </div>
        </div>
        <div class="flex items-center gap-2 rounded-full border border-white/10 bg-slate-900/60 px-3 py-1 text-xs text-slate-400">
          <span class="uppercase tracking-wide text-slate-500">Form</span>
          <input
            type="number"
            name="min_form"
            min="0"
            max="100"
            value="{{ filters.min_form }}"
            placeholder="Min"
            class="w-14 bg-transparent text-xs text-slate-200 placeholder:text-slate-500"
            hx-get="/players/market/"
            hx-target="#player-grid"
            hx-include="#player-filters"
            hx-trigger="change"
            hx-push-url="true"
          />
          <span class="text-slate-600">-</span>
          <input
            type="number"
            name="max_form"
            min="0"
            max="100"
            value="{{ filters.max_form }}"
            placeholder="Max"
            class="w-14 bg-transparent text-xs text-slate-200 placeholder:text-slate-500"
            hx-get="/players/market/"
            hx-target="#player-grid"
            hx-include="#player-filters"
            hx-trigger="change"
            hx-push-url="true"
          />
        </div>
      </div>
    </div>

    <div class="flex flex-wrap items-center gap-3">
      <div class="flex flex-wrap items-center gap-3 rounded-2xl border border-white/10 bg-slate-950/60 p-4">
        <div class="flex items-center gap-2 text-xs font-semibold uppercase tracking-[0.2em] text-slate-500">Availability</div>
        <label class="flex items-center gap-2 rounded-full border border-white/10 px-3 py-1 text-xs text-slate-300">
          <input
            type="checkbox"
            name="availability"
            value="transfer"
            {% if "transfer" in selected_availability %}checked{% endif %}
            class="rounded border-white/10 bg-slate-900/60"
            hx-get="/players/market/"
            hx-target="#player-grid"
            hx-include="#player-filters"
            hx-trigger="change"
            hx-push-url="true"
          />
          Transfer
        </label>
        <label class="flex items-center gap-2 rounded-full border border-white/10 px-3 py-1 text-xs text-slate-300">
          <input
            type="checkbox"
            name="availability"
            value="loan"
            {% if "loan" in selected_availability %}checked{% endif %}
            class="rounded border-white/10 bg-slate-900/60"
            hx-get="/players/market/"
            hx-target="#player-grid"
            hx-include="#player-filters"
            hx-trigger="change"
            hx-push-url="true"
          />
          Loan
        </label>
        <label class="flex items-center gap-2 rounded-full border border-white/10 px-3 py-1 text-xs text-slate-300">
          <input
            type="checkbox"
            name="availability"
            value="free_agent"
            {% if "free_agent" in selected_availability %}checked{% endif %}
            class="rounded border-white/10 bg-slate-900/60"
            hx-get="/players/market/"
            hx-target="#player-grid"
            hx-include="#player-filters"
            hx-trigger="change"
            hx-push-url="true"
          />
          Free Agent
        </label>
        <label class="flex items-center gap-2 rounded-full border border-white/10 px-3 py-1 text-xs text-slate-300">
          <input
            type="checkbox"
            name="availability"
            value="open_to_offers"
            {% if "open_to_offers" in selected_availability %}checked{% endif %}
            class="rounded border-white/10 bg-slate-900/60"
            hx-get="/players/market/"
            hx-target="#player-grid"
            hx-include="#player-filters"
            hx-trigger="change"
            hx-push-url="true"
          />
          Open to offers
        </label>
      </div>

      <div class="flex flex-1 flex-wrap items-center gap-3">
        <div class="flex flex-1 items-center gap-3 rounded-2xl border border-white/10 bg-slate-950/60 px-4 py-3">
          <input
            type="text"
            name="q"
            value="{{ filters.q }}"
            placeholder="Search player or club"
            class="w-full bg-transparent text-sm text-slate-200 placeholder:text-slate-500"
            hx-get="/players/market/"
            hx-target="#player-grid"
            hx-include="#player-filters"
            hx-trigger="keyup changed delay:300ms"
            hx-push-url="true"
          />
        </div>
        <div class="flex items-center gap-2 rounded-2xl border border-white/10 bg-slate-950/60 px-3 py-2">
          <span class="text-xs font-semibold uppercase tracking-[0.2em] text-slate-500">Sort</span>
          <select
            name="sort"
            class="bg-transparent text-sm text-slate-200"
            hx-get="/players/market/"
            hx-target="#player-grid"
            hx-include="#player-filters"
            hx-trigger="change"
            hx-push-url="true"
          >
            <option value="form_desc" {% if filters.sort == "form_desc" or not filters.sort %}selected{% endif %}>Form (High-Low)</option>
            <option value="market_desc" {% if filters.sort == "market_desc" %}selected{% endif %}>Market value (High-Low)</option>
            <option value="age_asc" {% if filters.sort == "age_asc" %}selected{% endif %}>Age (Low-High)</option>
            <option value="age_desc" {% if filters.sort == "age_desc" %}selected{% endif %}>Age (High-Low)</option>
            <option value="name" {% if filters.sort == "name" %}selected{% endif %}>Name (A-Z)</option>
          </select>
        </div>
        <input
          type="text"
          name="nationality"
          value="{{ filters.nationality }}"
          placeholder="Nationality"
          class="w-44 rounded-2xl border border-white/10 bg-slate-950/60 px-3 py-2 text-sm text-slate-200 placeholder:text-slate-500"
          hx-get="/players/market/"
          hx-target="#player-grid"
          hx-include="#player-filters"
          hx-trigger="change"
          hx-push-url="true"
        />
      </div>
    </div>
  </form>

  <div class="relative">
    <div id="player-grid" class="space-y-6" hx-indicator="#player-grid-loading">
      {% include "marketplace/_player_market_grid.html" %}
    </div>
    <div id="player-grid-loading" class="htmx-indicator absolute inset-0 flex items-center justify-center bg-slate-950/70 text-slate-200">
      <div class="flex items-center gap-3 rounded-full border border-white/10 bg-slate-900/80 px-4 py-2 text-xs font-semibold uppercase tracking-[0.2em] text-slate-300">
        <span class="h-3 w-3 animate-spin rounded-full border-2 border-slate-500 border-t-emerald-400"></span>
        Loading
      </div>
    </div>
  </div>
{% endblock %}
