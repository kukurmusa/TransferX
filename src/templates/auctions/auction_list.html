{% extends "base.html" %}
{% load roles %}

{% block title %}Listings | TransferX{% endblock %}

{% block page_title %}<h1 class="text-2xl font-semibold text-white">Listings</h1>{% endblock %}
{% block page_subtitle %}<p class="text-sm text-slate-400">Browse open listings and current offers.</p>{% endblock %}
{% block page_actions %}
  <form method="get" class="flex items-center gap-2">
    <select class="w-auto rounded-lg border-0 bg-slate-800 px-3 py-2 text-sm text-white ring-1 ring-white/10 focus:ring-emerald-500" name="sort" onchange="this.form.submit()">
      <option value="deadline" {% if sort == "deadline" %}selected{% endif %}>Deadline (Soon)</option>
      <option value="form_desc" {% if sort == "form_desc" %}selected{% endif %}>Form (High-Low)</option>
    </select>
  </form>
  {% if user|user_is_seller %}
    {% include "components/button.html" with text="Create Listing" href="/auctions/new/" variant="primary" size="md" %}
  {% endif %}
{% endblock %}

{% block content %}
  {% if auctions %}
    <div class="space-y-4">
      {% for auction in auctions %}
        {% url 'auctions:detail' auction.id as auction_url %}
        <div class="rounded-xl bg-slate-900 p-5 ring-1 ring-white/[0.08] transition-all duration-200 hover:ring-white/[0.15]">
          <div class="flex flex-wrap items-center justify-between gap-4">
            <div>
              <div class="text-lg font-semibold text-white">{{ auction.player.name }}</div>
              <div class="text-sm text-slate-400">Deadline: {{ auction.deadline|date:"M d, H:i" }}</div>
            </div>
            <div class="flex items-center gap-2">
              {% include "components/badge.html" with text=auction.get_status_display variant="neutral" size="sm" %}
              {% if auction.reserve_met is not None %}
                {% if auction.reserve_met %}
                  {% include "components/badge.html" with text="Reserve met" variant="success" size="sm" %}
                {% else %}
                  {% include "components/badge.html" with text="Reserve not met" variant="warning" size="sm" %}
                {% endif %}
              {% endif %}
            </div>
          </div>
          <div class="mt-4 grid gap-4 md:grid-cols-3">
            <div>
              <div class="text-xs font-medium uppercase tracking-wider text-slate-500">Current Best Offer</div>
              <div class="mt-1 text-sm font-semibold text-white">{% if auction.best_bid_amount %}GBP {{ auction.best_bid_amount }}{% else %}-{% endif %}</div>
            </div>
            <div>
              <div class="text-xs font-medium uppercase tracking-wider text-slate-500">Minimum Next Offer</div>
              <div class="mt-1 text-sm font-semibold text-white">{% if auction.minimum_next_bid %}GBP {{ auction.minimum_next_bid }}{% else %}-{% endif %}</div>
            </div>
            <div>
              <div class="text-xs font-medium uppercase tracking-wider text-slate-500">Form Score</div>
              <div class="mt-1 text-sm font-semibold text-white">
                {% if auction.player.form %}{{ auction.player.form.form_score|floatformat:1 }}{% else %}-{% endif %}
                {% if auction.player.form and auction.player.form.form_score >= 75 %}
                  {% include "components/badge.html" with text="Hot" variant="danger" size="sm" %}
                {% endif %}
              </div>
            </div>
          </div>
          <div class="mt-4 flex items-center justify-between border-t border-white/[0.05] pt-4">
            <div class="text-sm text-slate-500">{{ auction.bid_count }} offers</div>
            {% include "components/button.html" with text="View" href=auction_url variant="secondary" size="sm" %}
          </div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    {% include "components/empty_state.html" with title="No auctions found" description="Check back soon or create a new auction." %}
  {% endif %}
{% endblock %}
